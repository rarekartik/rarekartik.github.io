<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Maker | Kartik Chouhan</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://api.fontshare.com/v2/css?f[]=satoshi@900,700,500,400&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* RAREKARTIK THEME */
            --bg: #0a0a0a; 
            --surface: #171717; 
            --surface-hover: #262626; 
            --border: #333333;
            --text: #ffffff; 
            --text-dim: #a1a1aa; 
            --accent: #3b82f6; 
            --radius: 12px;
            --success: #10b981;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background-color: var(--bg); color: var(--text); 
            font-family: 'Satoshi', sans-serif; 
            height: 100dvh; overflow: hidden; 
            display: flex; flex-direction: row;
        }

        /* === 1. SIDEBAR (CONTROLS) === */
        .sidebar {
            width: 320px; min-width: 320px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column;
            z-index: 50; height: 100%;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), margin-left 0.3s ease;
        }
        
        .sidebar.collapsed { margin-left: -320px; }

        /* Header */
        .sidebar-header {
            padding: 20px; border-bottom: 1px solid var(--border);
            background: rgba(0,0,0,0.2); flex-shrink: 0;
        }
        .brand-row { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        .brand-icon { font-size: 1.3rem; color: var(--accent); }
        .brand-title { font-size: 1.3rem; font-weight: 900; color: white; letter-spacing: -0.5px; }
        .brand-desc { font-size: 0.8rem; color: var(--text-dim); }
        .credit { color: var(--accent); font-weight: 700; font-size: 0.75rem; margin-top: 4px; display: block; }

        /* Scrollable Content */
        .sidebar-scroll {
            flex: 1; overflow-y: auto; padding: 20px; 
            display: flex; flex-direction: column; gap: 20px;
        }

        /* Control Box */
        .control-section {
            background: var(--surface-hover); border: 1px solid var(--border);
            padding: 15px; border-radius: 12px;
        }
        .section-title {
            font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em;
            color: var(--text-dim); font-weight: 700; margin-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px;
        }

        /* Toggles */
        .toggle-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .toggle-row:last-child { border: none; }
        .toggle-label { font-size: 0.85rem; font-weight: 600; color: var(--text); }
        .toggle-sub { font-size: 0.7rem; color: var(--text-dim); }

        /* Switch */
        .switch { position: relative; display: inline-block; width: 40px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--border); border-radius: 34px; transition: .3s;
        }
        .slider:before {
            position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px;
            background-color: white; border-radius: 50%; transition: .3s;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(18px); }

        /* Buttons */
        .btn {
            background: var(--accent); color: white; border: none; width: 100%; padding: 14px;
            border-radius: 10px; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            font-size: 0.95rem; transition: 0.2s; font-family: 'Satoshi', sans-serif;
        }
        .btn:hover:not(:disabled) { background: white; color: black; }
        .btn:disabled { background: var(--border); color: var(--text-dim); cursor: not-allowed; opacity: 0.7; }
        
        .btn-outline {
            background: transparent; border: 1px solid var(--border); color: var(--text); font-weight: 600; margin-top: 10px;
        }
        .btn-outline:hover { border-color: var(--accent); color: var(--accent); }

        /* Fixed Bottom Action Area */
        .sidebar-bottom {
            padding: 20px; border-top: 1px solid var(--border);
            background: var(--surface); flex-shrink: 0;
        }

        .sidebar-footer {
            padding-top: 10px; text-align: center;
            font-size: 0.7rem; color: var(--text-dim);
        }

        /* === 2. PREVIEW AREA === */
        .preview-area {
            flex-grow: 1; background: #050505;
            background-image: radial-gradient(#222 1px, transparent 1px);
            background-size: 20px 20px;
            padding: 30px; overflow: auto;
            display: flex; flex-direction: column; align-items: center;
            position: relative;
        }

        /* Top Nav Island */
        .nav-island {
            position: absolute; top: 20px; right: 20px;
            background: rgba(23, 23, 23, 0.9); backdrop-filter: blur(10px);
            border: 1px solid var(--border); padding: 6px 12px; border-radius: 30px;
            display: flex; align-items: center; gap: 10px; z-index: 20;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .nav-link { color: var(--text-dim); text-decoration: none; font-size: 0.85rem; font-weight: 700; transition: 0.2s; padding: 5px 10px; }
        .nav-link:hover { color: white; }
        
        /* Secondary Generate Button in Header */
        .header-btn {
            background: var(--accent); color: white; border: none;
            padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; font-weight: 700;
            cursor: pointer; display: flex; align-items: center; gap: 6px;
        }
        .header-btn:hover { background: white; color: black; }
        .header-btn:disabled { background: var(--border); color: var(--text-dim); cursor: not-allowed; }

        /* Hamburger Toggle (Desktop) */
        .sidebar-toggle {
            position: absolute; top: 20px; left: 20px;
            width: 40px; height: 40px; border-radius: 8px;
            background: var(--surface); border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center;
            color: var(--text); cursor: pointer; z-index: 20;
            transition: 0.2s;
        }
        .sidebar-toggle:hover { border-color: var(--accent); color: var(--accent); }

        /* Drop Zone */
        .drop-zone {
            width: 100%; max-width: 600px; height: 400px; margin-top: 60px;
            border: 2px dashed var(--border); border-radius: 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.02); transition: 0.3s; cursor: pointer;
        }
        .drop-zone:hover { border-color: var(--accent); background: rgba(59, 130, 246, 0.05); }
        .drop-icon { font-size: 4rem; color: var(--text-dim); margin-bottom: 20px; }
        .drop-text { font-size: 1.5rem; font-weight: 700; color: var(--text); }
        .drop-sub { color: var(--text-dim); margin-top: 10px; }

        /* Grid View */
        .grid-view {
            display: none; width: 100%; max-width: 1000px; 
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px;
            align-content: start; height: 100%; padding-top: 60px;
        }
        .thumb-card {
            background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
            overflow: hidden; height: 180px; 
            display: flex; align-items: center; justify-content: center;
            position: relative; animation: zoomIn 0.3s ease-out; cursor: grab;
            background: rgba(255,255,255,0.02);
        }
        .thumb-img { 
            width: 100%; height: 100%; 
            object-fit: contain; 
            padding: 5px; 
        }
        .page-num {
            position: absolute; bottom: 8px; right: 8px;
            background: rgba(0,0,0,0.7); color: white; font-size: 0.7rem; font-weight: 700;
            padding: 2px 8px; border-radius: 4px;
        }

        /* === MOBILE RESPONSIVE === */
        .mobile-header, .backdrop { display: none; }

        @media (max-width: 900px) {
            body { flex-direction: column; height: auto; }
            
            .sidebar {
                position: fixed; top: 0; left: 0; height: 100vh; width: 85vw; max-width: 350px;
                transform: translateX(-100%); border-right: 1px solid var(--border);
                box-shadow: 10px 0 50px rgba(0,0,0,0.5); z-index: 200; margin-left: 0;
            }
            .sidebar.active { transform: translateX(0); }

            .mobile-header {
                display: flex; justify-content: space-between; align-items: center;
                padding: 15px 20px; background: var(--surface); border-bottom: 1px solid var(--border);
                position: sticky; top: 0; z-index: 100; width: 100%;
            }
            .mobile-toggle-btn { display: flex; font-size: 1.2rem; cursor: pointer; color: var(--text); }

            .sidebar-toggle { display: none; }
            .nav-island { display: none; } 

            .preview-area { padding: 20px; min-height: 80vh; padding-top: 20px; }
            
            .backdrop {
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); backdrop-filter: blur(3px);
                z-index: 150; display: none;
            }
            .backdrop.active { display: block; }
            
            .drop-zone { height: 300px; margin-top: 0; }
            .grid-view { padding-top: 0; }
        }

        @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>

    <div class="mobile-header">
        <div style="display:flex; align-items:center; gap:15px;">
            <div class="mobile-toggle-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
            <div style="font-weight:900; font-size:1.1rem;">PDF Maker</div>
        </div>
        <a href="index.html" style="color:var(--accent); text-decoration:none; font-size:0.9rem; font-weight:700;">Home</a>
    </div>

    <div class="backdrop" id="backdrop" onclick="toggleSidebar()"></div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="brand-row">
                <div class="brand-icon"><i class="fas fa-file-pdf"></i></div>
                <div class="brand-title">PDF Maker</div>
            </div>
            <div class="brand-desc">Secure Document Converter</div>
            <div class="credit">Developed by Kartik Chouhan</div>
        </div>

        <div class="sidebar-scroll">
            
            <div class="control-section">
                <div class="section-title">Files</div>
                <input type="file" id="fileInput" multiple accept="image/*" hidden>
                
                <div id="fileCount" style="text-align:center; margin-bottom:10px; font-family:'JetBrains Mono', monospace; color:var(--success); font-size:0.8rem; display:none;">0 Pages Loaded</div>
                
                <button class="btn btn-outline" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-plus"></i> Add Images
                </button>
            </div>

            <div class="control-section">
                <div class="section-title">Options</div>
                
                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">Fit Width</div>
                        <div class="toggle-sub">Standardize width (Rec)</div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="normalizeWidth" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">High Quality</div>
                        <div class="toggle-sub">Less compression</div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" checked disabled>
                        <span class="slider" style="background:var(--accent); opacity:0.5;"></span>
                    </label>
                </div>
            </div>

        </div>

        <div class="sidebar-bottom">
            <button class="btn" id="convertBtn" onclick="generatePDF()" disabled>
                <i class="fas fa-file-export"></i> Generate PDF
            </button>
            <div id="loading" style="text-align:center; color:var(--text-dim); margin-top:10px; font-size:0.75rem; display:none;">
                Processing...
            </div>
            <div class="sidebar-footer">
                &copy; 2026 PDF Maker. Developed by Kartik Chouhan.
            </div>
        </div>
    </div>

    <div class="preview-area">
        
        <div class="sidebar-toggle" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </div>

        <nav class="nav-island">
            <a href="index.html" class="nav-link"><i class="fas fa-arrow-left"></i> Back to Home</a>
            <button class="header-btn" id="headerConvertBtn" onclick="generatePDF()" disabled>
                <i class="fas fa-download"></i> Save PDF
            </button>
        </nav>

        <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
            <div class="drop-icon"><i class="fas fa-images"></i></div>
            <div class="drop-text">Drop Images Here</div>
            <div class="drop-sub">JPG, PNG, WEBP Supported</div>
        </div>

        <div class="grid-view" id="gridView">
            </div>

    </div>

    <script>
        const { jsPDF } = window.jspdf;
        
        // Elements
        const fileInput = document.getElementById('fileInput');
        const dropZone = document.getElementById('dropZone');
        const gridView = document.getElementById('gridView');
        const convertBtn = document.getElementById('convertBtn');
        const headerBtn = document.getElementById('headerConvertBtn');
        const loading = document.getElementById('loading');
        const fileCount = document.getElementById('fileCount');
        const sidebar = document.getElementById('sidebar');
        const backdrop = document.getElementById('backdrop');
        
        let filesArray = [];

        // Toggle Sidebar
        function toggleSidebar() {
            if (window.innerWidth <= 900) {
                sidebar.classList.toggle('active');
                backdrop.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
            }
        }

        // --- Drop Zone Logic ---
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.style.borderColor = 'var(--accent)'; dropZone.style.background = 'rgba(59,130,246,0.1)'; });
        dropZone.addEventListener('dragleave', (e) => { dropZone.style.borderColor = 'var(--border)'; dropZone.style.background = 'rgba(255,255,255,0.02)'; });
        dropZone.addEventListener('drop', (e) => { e.preventDefault(); if(e.dataTransfer.files.length) handleFiles(e.dataTransfer.files); });
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        function handleFiles(files) {
            if (!files.length) return;
            filesArray = [...filesArray, ...Array.from(files)];
            updateUI();
        }

        function updateUI() {
            if (filesArray.length > 0) {
                dropZone.style.display = 'none';
                gridView.style.display = 'grid';
                
                fileCount.style.display = 'block';
                fileCount.innerText = `${filesArray.length} Pages Loaded`;
                
                convertBtn.disabled = false;
                headerBtn.disabled = false;
                
                // Clear and Rebuild Grid
                gridView.innerHTML = '';
                filesArray.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const div = document.createElement('div');
                        div.className = 'thumb-card';
                        div.innerHTML = `
                            <img src="${e.target.result}" class="thumb-img">
                            <span class="page-num">${index + 1}</span>
                        `;
                        gridView.appendChild(div);
                    };
                    reader.readAsDataURL(file);
                });
            }
        }

        // --- Generation Logic (Dynamic Page Size) ---
        async function generatePDF() {
            if(filesArray.length === 0) return;

            loading.style.display = 'block';
            convertBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Building...';
            headerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            convertBtn.disabled = true;
            headerBtn.disabled = true;

            setTimeout(async () => {
                try {
                    let doc;
                    const normalize = document.getElementById('normalizeWidth').checked;
                    
                    // A4 Width in points (for normalization)
                    const STD_WIDTH = 595.28; 

                    for (let i = 0; i < filesArray.length; i++) {
                        const imgData = await readFile(filesArray[i]);
                        const dims = await getImageDims(imgData);
                        
                        let w, h;

                        if (normalize) {
                            // Scale to standard document width (595pt), let height flex
                            // This ensures zoom levels are normal in PDF viewers
                            const scale = STD_WIDTH / dims.w;
                            w = STD_WIDTH;
                            h = dims.h * scale;
                        } else {
                            // Use Native Dimensions (scaled to PDF Points)
                            // 1px = 0.75pt (96dpi) to prevent "Billboard" effect
                            const scale = 0.75; 
                            w = dims.w * scale;
                            h = dims.h * scale;
                        }

                        if (i === 0) {
                            doc = new jsPDF({
                                orientation: w > h ? 'l' : 'p',
                                unit: 'pt',
                                format: [w, h]
                            });
                        } else {
                            doc.addPage([w, h], w > h ? 'l' : 'p');
                        }

                        doc.addImage(imgData, 'JPEG', 0, 0, w, h);
                    }

                    doc.save(`PDF_Maker_${Date.now()}.pdf`);
                    
                    // Reset UI
                    loading.style.display = 'none';
                    convertBtn.innerHTML = '<i class="fas fa-check"></i> Done';
                    headerBtn.innerHTML = '<i class="fas fa-check"></i> Saved';
                    
                    setTimeout(() => {
                        convertBtn.innerHTML = '<i class="fas fa-file-export"></i> Generate PDF';
                        headerBtn.innerHTML = '<i class="fas fa-download"></i> Save PDF';
                        convertBtn.disabled = false;
                        headerBtn.disabled = false;
                    }, 2000);

                } catch (err) {
                    alert("Error processing images. Try smaller batches.");
                    console.error(err);
                    loading.style.display = 'none';
                    convertBtn.disabled = false;
                    headerBtn.disabled = false;
                }
            }, 100);
        }

        // Helpers
        const readFile = (file) => new Promise((res) => {
            const r = new FileReader(); r.onload = () => res(r.result); r.readAsDataURL(file);
        });
        const getImageDims = (url) => new Promise((res) => {
            const i = new Image(); i.onload = () => res({ w: i.width, h: i.height }); i.src = url;
        });

    </script>

</body>
</html>